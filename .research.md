# RPI CLI Tool - Research & Scope

## TCREI Validation

### Task
Build a Node.js CLI tool that implements RPI Framework workflows and publish to npm.

### Context
Transform the RPI Framework from documentation-only into an installable product that developers can use immediately. The CLI should guide users through Research â†’ Plan â†’ Implement workflow with built-in templates and validation.

### Reference
- **Existing**: RPI framework docs in `docs/core/`, slash commands in `.claude/commands/`
- **Similar tools**: `create-react-app`, `nest-cli`, `vue-cli`, `plop`
- **Best practices**: Commander.js for CLI, Inquirer.js for prompts, Chalk for colors

### Evaluation Success Metrics
- âœ… Published to npm as `@rpi-framework/cli` or `rpi-cli`
- âœ… Users can `npm install -g rpi-cli` and start using
- âœ… Core commands work: init, research, plan, verify, metrics
- âœ… Generates proper .research.md and .plan.md files
- âœ… Zero config - works out of the box

### Input Requirements
- Node.js 18+ environment
- npm account for publishing
- Package name availability check
- Testing framework (Vitest or Jest)

---

## Core Features (MVP)

### Command 1: `rpi init [project-name]`
**Purpose**: Initialize RPI framework in a project

**What it does:**
- Creates `.rpi/` directory
- Copies template files (research, plan, completion templates)
- Creates `.rpi/config.json` for settings
- Initializes metrics tracking

**Files created:**
```
.rpi/
  â”œâ”€â”€ config.json
  â”œâ”€â”€ templates/
  â”‚   â”œâ”€â”€ research.template.md
  â”‚   â”œâ”€â”€ plan.template.md
  â”‚   â””â”€â”€ completion.template.md
  â””â”€â”€ metrics.json
```

---

### Command 2: `rpi research <task-description>`
**Purpose**: Create structured research document with TCREI validation

**What it does:**
- Prompts user for TCREI elements (interactive):
  - **T**ask: What exactly needs to be done?
  - **C**ontext: Why is this needed?
  - **R**eference: Any examples or patterns?
  - **E**valuation: How to measure success?
  - **I**nput: What files/data to examine?
- Validates all fields are filled
- Generates `.research.md` with structured format
- Adds timestamp and confidence scoring placeholders

**Output example:**
```markdown
# Research: Add User Authentication

**Created**: 2025-12-08T14:30:00Z
**Status**: In Progress

## TCREI Validation

**Task**: Implement user authentication with JWT tokens
**Context**: Users need secure login to access protected features
**Reference**: Auth0 patterns, existing session handling in auth.ts:45
**Evaluation**: Users can login/logout, tokens expire after 1hr, 99% uptime
**Input**:
- src/auth/ directory
- database schema for users table
- existing middleware patterns

## Next Steps
- [ ] Read auth.ts and understand current implementation
- [ ] Review database schema
- [ ] Create plan document
```

---

### Command 3: `rpi plan [--from-research]`
**Purpose**: Generate implementation plan with Task/Progress Ledgers

**What it does:**
- Reads `.research.md` (if exists)
- Prompts for:
  - Task Ledger: Strategic goals, facts vs guesses, decision points
  - Progress Ledger: Atomic steps (MAKER decomposition)
- Generates `.plan.md` with dual-loop structure
- Includes test commands, confidence scores

**Output example:**
```markdown
# Implementation Plan: Add User Authentication

## Task Ledger (Strategic)

**Facts:**
- âœ“ Database has users table (verified in schema.ts:23)
- âœ“ JWT library already installed (package.json:45)

**Guesses:**
- ? Need to add password hashing (bcrypt)
- ? Sessions might conflict with JWT approach

**Decision Points:**
- [ ] JWT vs Session-based auth
- [ ] Where to store refresh tokens

## Progress Ledger (Tactical)

### Step 1: Read existing auth implementation
- **Input**: src/auth/auth.ts
- **Action**: Document current patterns
- **Output**: Notes on existing structure
- **Verification**: Can explain current flow
- **Confidence**: 95%

### Step 2: Design JWT token structure
- **Input**: User schema, security requirements
- **Action**: Define JWT payload and expiration
- **Output**: Token structure spec
- **Verification**: Passes security review checklist
- **Confidence**: 80%

[... more steps ...]
```

---

### Command 4: `rpi verify <file-path>`
**Purpose**: Run Chain of Verification (CoVe) on claims

**What it does:**
- Reads specified file
- Extracts claims (statements that could be verified)
- Prompts for verification sources
- Generates verification report
- Updates confidence scores

**Example:**
```bash
$ rpi verify .plan.md

Found 3 claims to verify:
1. "JWT library already installed"
   Source? â†’ package.json:45
   Verified: âœ“ (jsonwebtoken@9.0.0)

2. "Database has users table"
   Source? â†’ schema.ts:23
   Verified: âœ“ (found users table definition)

3. "Need to add password hashing"
   Source? â†’ [pending verification]
   Verified: ? (marked as guess)

Confidence Score: 67% (2/3 verified)
```

---

### Command 5: `rpi metrics`
**Purpose**: Show token savings and productivity stats

**What it does:**
- Reads `.rpi/metrics.json`
- Displays:
  - Sessions completed
  - Avg tokens per session (before/after)
  - Token savings percentage
  - Tasks completed
  - Confidence score trends

**Output:**
```
ğŸ“Š RPI Framework Metrics

Sessions: 12
Token Savings: 96% (41,000 â†’ 1,500 avg)
Tasks Completed: 8
Avg Confidence: 82%

Breakdown:
- Research phases: 4
- Plans created: 8
- Verifications run: 23
- Claims verified: 67/89 (75%)
```

---

### Command 6: `rpi status`
**Purpose**: Show current RPI workflow state

**What it does:**
- Check for .research.md, .plan.md
- Show which phase user is in
- Display next recommended action

**Output:**
```
ğŸ¯ RPI Status

Current Phase: Planning
Research: âœ“ Complete (.research.md)
Plan: âš ï¸  In Progress (.plan.md)
Implementation: â³ Not started

Next Action: Complete .plan.md and run `rpi implement`
```

---

## Technical Architecture

### Package Structure
```
rpi-cli/
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ rpi.js                 # CLI entry point
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”œâ”€â”€ init.js
â”‚   â”‚   â”œâ”€â”€ research.js
â”‚   â”‚   â”œâ”€â”€ plan.js
â”‚   â”‚   â”œâ”€â”€ verify.js
â”‚   â”‚   â”œâ”€â”€ metrics.js
â”‚   â”‚   â””â”€â”€ status.js
â”‚   â”œâ”€â”€ templates/             # .md templates
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ tcrei.js          # TCREI validation logic
â”‚   â”‚   â”œâ”€â”€ maker.js          # MAKER decomposition
â”‚   â”‚   â”œâ”€â”€ cove.js           # Chain of Verification
â”‚   â”‚   â””â”€â”€ file-helpers.js
â”‚   â””â”€â”€ index.js
â”œâ”€â”€ tests/
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â””â”€â”€ LICENSE
```

### Dependencies
```json
{
  "dependencies": {
    "commander": "^11.0.0",      // CLI framework
    "inquirer": "^9.0.0",        // Interactive prompts
    "chalk": "^5.0.0",           // Terminal colors
    "ora": "^7.0.0",             // Spinners
    "boxen": "^7.0.0",           // Boxes around text
    "markdown-it": "^14.0.0",    // Parse markdown
    "glob": "^10.0.0",           // File pattern matching
    "fs-extra": "^11.0.0"        // Enhanced file operations
  },
  "devDependencies": {
    "vitest": "^1.0.0",
    "eslint": "^8.0.0"
  }
}
```

### Package Name Options
1. `rpi-cli` - Simple, direct
2. `@rpi-framework/cli` - Namespaced (professional)
3. `rpi-ai` - Emphasizes AI focus
4. `research-plan-implement` - Descriptive but long

**Recommendation**: `rpi-cli` (available on npm as of Dec 2025)

---

## Implementation Confidence Scores

| Feature | Complexity | Confidence | Notes |
|---------|-----------|-----------|-------|
| `rpi init` | Low | 95% | Standard file creation |
| `rpi research` | Medium | 85% | Interactive prompts well-documented |
| `rpi plan` | Medium | 80% | Template generation straightforward |
| `rpi verify` | High | 70% | Claim extraction needs refinement |
| `rpi metrics` | Low | 90% | JSON read/write simple |
| npm publish | Low | 95% | Standard process |

**Overall Confidence**: 85%

---

## Open Questions

1. **Package name**: Prefer `rpi-cli` or scoped `@rpi-framework/cli`?
2. **Templates**: Include all RPI docs as templates or minimal versions?
3. **AI Integration**: Should CLI call Claude API directly or stay tool-only?
4. **Versioning**: Start at 0.1.0 (beta) or 1.0.0 (stable)?
5. **License**: MIT (fully open) or dual-license option?

---

## Next Steps

1. âœ… Create research document (this file)
2. â³ Get user approval on scope
3. â³ Create implementation plan
4. â³ Build package structure
5. â³ Implement core commands
6. â³ Test locally
7. â³ Publish to npm
8. â³ Create usage documentation

**Estimated Time**: 1-2 days for MVP, 1 week for polished v1.0
